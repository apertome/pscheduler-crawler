filter {
   json {
	source => "message"

   }

}

filter {
	if [archivings] {
		ruby { 
			path => "/etc/logstash/ps_flatten.rb"

		}
	}
}



# todo: track runs where state is finished but merged success shows failure 
# or vice versa

filter {
	mutate {
		rename => { "type" => "ps_type" }

	}

 if [result-merged] {
	mutate {
		copy => { "[result-merged][succeeded]" => "run-succeeded"  }

	}
}



 if [result] {
	mutate {
		replace => { "result" =>  "[removed-result]" }
	}
  }

 if [result-full] {
	mutate {
		replace => { "result-full" =>  "[removed-result-full]" }
	}
  }
 if [result-merged] {
	mutate {
		remove_field => [ "[result-merged][histogram-latency]", "[result-merged][histogram-owdelay]", "[result-merged][histogram-rtt]", "[result-merged][histogram-ttl]" ]
	}
	mutate {
		rename => { "[result-merged]" => "[crawler][result-merged]" }
	}
	mutate {
		replace => { "result-merged" =>  "[removed-result-merged]" }
	}
  }

}

filter {
  mutate {
    remove_field => [ "message" ]
  }
}

output {
    stdout {
            codec => "rubydebug"
    }
 }
